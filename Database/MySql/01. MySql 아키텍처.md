# MySql 아키텍처

![IMAGES](./images/mysql.JPG)

MySql 아키텍처는 크게 4가지로 구분할 수 있습니다.

- __MySql 접속 클라이언트__
  - MySQL Connectors
  - MySQL Shell
  - MySQL 은 대부분의 프로그래밍 언어에 대해 접속 API 를 제공한다. 그리고 Shell 에서도 Script 를 통해 MySQL 에 접속할 수 있다.
- __MySQL 엔진__ : MySQL 의 두뇌
  - 쿼리 파서
  - 전처리기
  - 옵티마이저
    - 요청된 SQL 문을 최적화하여 실행시키기 위해 실행 계획을 짜는 중요한 역할을 한다.
    - MySQL 엔진을 두뇌에 비유한 이유는 이 옵티마이저 때문이다.
  - 실행 엔진
- __MySQL 스토리지 엔진__
  - 스토리지 엔진은 데이터를 실제로 디스크에 저장하거나, 디스크에 저장된 데이터를 읽어오는 역할을 담당한다.
  - MySQL 엔진은 옵티마이저가 작성한 실행 계획에 따라서 스토리지 엔진을 적절히 호출해서 쿼리를 실행한다.
  - MySQL 엔진이 스토리지 엔진을 호출할 때 사용하는 API 를 `핸들러 API` 라고 한다.
  - 핸들러 API 를 직접 구현하여 나만의 스토리지 엔진을 추가할 수도 있다.
- __운영체제, 하드웨어__
  - 실제 테이블의 데이터와 로그 데이터를 파일로 저장하는 역할을 담당한다.

## 쿼리 실행 과정

![IMAGES](./images/opt.JPG)

- __쿼리 캐시__
  - 클라이언트가 SQL 요청을 MySQL 로 보내면 가장 먼저 `쿼리 캐시(Query Cache)` 를 만난다.
  - SQL 실행 결과를 메모리에 캐싱하는 역할
  - 동일 SQL 실행시 이전 결과 즉시 반환
  - 테이블의 데이터가 변경되면 캐싱된 데이터 삭제 필요(동시 처리 성능 저하)
      - 더 이상 쓸모 없어지게 된 캐싱 데이터를 삭제할 때마다 쿼리 캐시에 접근하는 쓰레드에 Lock 이 걸리는데 이는 심각한 동시 처리 성능 저하를 유발한다.
  - Mysql 8.0 부터 완전히 제거됨
- __쿼리 파서__
  - 쿼리 파서는 기본적인 SQL 문장 오류를 체크한다.
  - SQL 문장을 토큰으로 쪼개서 트리로 만듦
  
![IMAGES](./images/parsetree.JPG)

MySQL 은 이 Parse Tree 를 사용하여 쿼리를 실행한다.

## References

> https://www.youtube.com/watch?v=vQFGBZemJLQ&list=PLgXGHBqgT2TvpJ_p9L_yZKPifgdBOzdVH&index=3
