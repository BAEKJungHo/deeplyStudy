# 교착상태(Deadlock)

두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 결과적으로 아무것도 완료되지 못하는 상태

> Ex. 한 사람은 벤치, 한 사람은 렉을 사용중인데 서로 상대만 바라보며 상대가 언제 나오는지 하염없이 자기가 사용 중인 기구에서 기다려서 아무것도 완료되지 못하는 상태

둘 이상의 프로세스 혹은 스레드가 `한정된 자원`을 얻지 못해 다음 처리를 진행하지 못하는 상태를 의미한다.

가장 쉽게 접할 수 있는 Deadlock 이 Transcation Deadlock 이다. 트랜잭션이 레코드나 테이블을 update 할 때 lock 을 통해서 자원을 얻게 되는데, 이때 동일 테이블이나 레코드에 대해서 여러개의
트랜잭션이 동시에 접근하는 경우 Deadlock 이 발생할 수 있다.

## 교착상태가 발생할 조건

- 상호 배제(mutual exclusion)
- 점유 대기(hold and wait)
- 비선점(no preemption)
- 순환 대기(circular wait)

네 가지 조건을 `모두 만족`하면 교착 상태가 발생

## 교착 상태가 발생되지 않도록 사전에 예방하는 방법

네 가지 발생 조건 중 `하나`를 제거함으로써 해결하는 방법

1. 상호 배제 조건 제거
2. 점유 대기 조건 제거
3. 비선점 조건 제거
4. 순환 대기 조건 제거

일반적으로 자원 사용 `효율성`이 떨어지고 `비용`이 많이 드는 방법

### 데드락 회피

교착 상태 발생 가능성을 검사해서 `발생 가능성이 있다면 사전에 회피`하는 방식

1. 자원 할당 그래프 알고리즘(Resource Allocation Graph Algorithm)
2. 은행원 알고리즘(Banker's Algorithm)

#### 데드락 회피 흐름

1. 프로세스가 자원 요청 시, 자원을 할당한 후에도 안정 상태로 남아있는지 사전 검사
2. 안정 상태라면 자원을 할당
3. 불안정 상태라면 다른 프로세스가 자원을 해지할 때까지 대기

자원을 요청할 때마다 시스템 상태를 검사하는 만큼 `오버헤드`가 큼. 은행원 알고리즘의 경우 `전제 조건`이 많음

## 데드락 탐지 및 회복

교착 상태를 일으킨 프로세스를 종료하거나, 할당된 자원을 해제함으로써 회복

- __방법1. 프로세스 종료__
  - 교착 상태의 프로세스를 모두 중지
  - 교착 상태가 제거될 때까지 한 프로세스씩 중지
- __방법 2. 자원 선점__
  - 교착 상태가 제거될 때까지 프로세스가 점유한 자원을 선점해 다른 프로세스에게 할당

### 회복 고려사항

- 희생자 선택
- 후퇴(Rollback)
- 기아 상태(Starvation)

## 데드락 무시 방법

교착 상태 자체를 무시하고, 특별한 조치를 취하지 않는 방법

교착 상태의 발생 확률이 낮은 상황에서 주로 사용

